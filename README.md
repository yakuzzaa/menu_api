# Menu API | Homework Y_lab

## Техническое задание:

Написать проект на FastAPI с использованием PostgreSQL в качестве БД. В проекте следует реализовать REST API по работе с меню ресторана, все CRUD операции. Для проверки задания, к презентации будет приложена Postman коллекция с тестами. Задание выполнено, если все тесты проходят успешно. Даны 3 сущности: Меню, Подменю, Блюдо.

__Зависимости__:

1. У меню есть подменю, которые к ней привязаны.
2. У подменю есть блюда.

__Условия__:

* Блюдо не может быть привязано напрямую к меню, минуя подменю.
* Блюдо не может находиться в 2-х подменю одновременно.
* Подменю не может находиться в 2-х меню одновременно.
* Если удалить меню, должны удалиться все подменю и блюда этого меню.
* Если удалить подменю, должны удалиться все блюда этого подменю.
* Цены блюд выводить с округлением до 2 знаков после запятой.
* Во время выдачи списка меню, для каждого меню добавлять кол-во подменю и блюд в этом меню.
* Во время выдачи списка подменю, для каждого подменю добавлять кол-во блюд в этом подменю.
* Во время запуска тестового сценария БД должна быть пуста.

# Задания со звездочкой
 1. Фоновая задача реализована в google_sheet директории. Вместо локальной таблицы используется google sheets: https://docs.google.com/spreadsheets/d/1BUrzAiPP5ZVJ5VTjNHA5yTIMPNJmHVUWKSVbImB_Vb4/edit#gid=0
 2. Инвалидация кэша с помощью background tasks реализована в директории services
 3. Эндпоинт для получения всех меню со всеми подменю и блюдами -> views -> menu - > get_all
 4. Тест для эндпоинта tests -> crud_tests -> dish_api_test -> test_get_all_data
 5. Ручки api описаны в соответствии с OpenApi -> views
 6. Аналог django_reverse реализован в utils/urls_utils
 7. Вывод количества подменю и блюд для Меню одним сложным запросом реализован в services/menu на 15 и 48(функции find_all и find_by_id) строчках и в services/submenu на 15 и 44 строчках (функции find_all и find_by_id)
 8. Тестовый сценарий «Проверка кол-ва блюд и подменю в меню» из Postman реализован в tests/test_script_postman
 9. Блюда по акции реализованы в utils/discount_utils. Эта функция используется в services/dish/get_dish, services/dish/get_dish_by_id и в services/menu/full_menu_info

## Запуск проекта в Docker
1. Склонировать репозиторий
2. Создать в корне проекта `.env` и `.env.test` файлы, в них указать настройки для своей базы данных. Пример заполнения находится в файле `.env.example` и в `.env.example.test`
3. Установить Docker
4. Чтобы запустить контейнер с приложением, в терминале из корня проекта выполнить команду `docker compose up`
5. Теперь документацию проекта можно посмотреть по ссылке http://localhost:8000/docs
6. Для запуска тестов в терминале из корня проекта выполнить команду `docker-compose -f run_tests.yml up -d`
7. Посмотреть результаты прохождения тестов можно с помощью команды `docker logs -f y_lab_tests`



## Запуск проекта

__Версия Python 3.11__
1. Склонировать репозиторий
2. Активировать виртуальное окружение командой `poetry shell`
3. Установить зависимости командой `poetry install`
4. Создать базу данных
4. Создать в корне проекта `.env` файл, в нем указать настройки для своей базы данных. Пример заполнения находится в файле `.env.example`
5. Накатить миграции с помощью команды `alembic upgrade head`
5. Запустить сервер через IDE или командой `uvicorn main:app --reload`
6. Для просмотра документации по API, запустить проект и перейти на url http://localhost/docs
7. Для запуска тестов в терминале из корня проекта выполнить команду `python -m pytest -v`
